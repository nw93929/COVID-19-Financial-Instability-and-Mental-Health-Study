---
title: "Missing Data Analysis" 
author: "Nathan Wan"
fontsize: 12pt
geometry: margin=1in
urlcolor: black
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, highlight=FALSE,warning=FALSE)
options(tinytex.verbose = TRUE)
```
```{r}
library(tidyverse)
library(finalfit)

ppdata = read.csv("surveydata.csv")

# select variables of interest
data = select(ppdata, AGE, SEX, RACEREC, EDUC, SAT1, SAT2, SAT3, SAT4, SAT5, HEALTH_INS, MARSTAT, SEXUALITY, HH_PEOPLE, FINAL_WGT, MENT_HEALTH, PTSD, DEPRESSION, ANXIETY, ALC_DIS, SLEEPHRS, SLEEP_TROUBLE, DOWN, WORRY, INTEREST, NERVOUS, JOB_WORKLOAD, COV_FINSIT, HOUSING_2, COV_MH, COV_STIMULUS, COV_MEDBILLS, COV_OTHERPAYMENT, COV_CREDITDEBT, COV_RENTMORT, COV_MONEYFOOD, COV_EXTUI, RELIG_IMP, EMP_1, EMP_2, LAIDOFF, DISABLED, STUDENT, RETIRED)

# data type validation
data = data %>%
  mutate_if(~is.numeric(.), as.factor) %>%
  mutate_at(vars(DOWN, WORRY, INTEREST, NERVOUS, SAT1, SAT2, SAT3, SAT4, SAT5, AGE), as.numeric)

data$SEX = factor(data$SEX, levels = c(1, 2, 3), labels = c("Male", "Female", "Other"))
data$MARSTAT = factor(data$MARSTAT, levels = c(1, 2, 3,4,5,6,99), labels = c("Married", "Divorced", "Separated", "Widowed", "Single", "Unmarried couple", "Refusal"))
data$COV_RENTMORT = factor(data$COV_RENTMORT, levels = c(1,2,99), labels = c("Yes", "No", "Refusal"))

# SAT variable creation
data = data %>% mutate(SAT_total = ifelse(rowSums(select(., SAT1:SAT5) == 99, na.rm = TRUE) > 0, NA, rowSums(select(., SAT1:SAT5), na.rm = TRUE)))

# WORRY variable creation
data = data %>% mutate(across(c(DOWN, WORRY, INTEREST, NERVOUS), ~ ifelse(. %in% c(98,99), NA, .)))
data = data %>% mutate(worry_total = rowSums(select(., DOWN, WORRY, INTEREST, NERVOUS), na.rm = TRUE))
```
### Missing Data
```{r}
# replace 96, 98, 99, 100 with NA
data = data %>% mutate(across(everything(), ~na_if(., 96)))
lapply(data, table)

explanatory = c("COV_FINSIT", "HOUSING_2", "COV_MH", "COV_STIMULUS", "COV_MEDBILLS", "COV_OTHERPAYMENT", "COV_CREDITDEBT", "COV_RENTMORT", "COV_MONEYFOOD", "COV_EXTUI")
response = c("SAT_total", "worry_total")

data %>% missing_plot()

data %>% missing_pattern(response, explanatory)
```